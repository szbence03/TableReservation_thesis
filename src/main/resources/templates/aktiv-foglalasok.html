<!DOCTYPE html>
<html lang="hu" xmlns:th="https://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <title>Aktív foglalásaim</title>
</head>
<body data-bs-theme="dark" class="bg-body-tertiary">

<header class="p-3 text-bg-dark" data-bs-theme="dark">
  <div th:replace="~{/header :: header}"></div>
</header>

<main class="w-100" style="max-width:800px;margin: auto;">
  <div class="d-flex justify-content-center mt-5 mb-3">
    <h1>Aktív foglalásaim</h1>
  </div>

  <div class="d-flex justify-content-center mb-3 alert alert-danger" th:if="${hiba}" role="alert">
    <p th:text="${hiba}" class="text-center"> </p>
  </div>
  <div class="d-flex justify-content-center mb-3 alert alert-success" th:if="${sikeresTorles}" role="alert">
    <p th:text="${sikeresTorles}" class="text-center"> </p>
  </div>
  <p class="text-center fs-4" th:if="${felhasznalo.foglalasok == null || felhasznalo.foglalasok.isEmpty()}"> Jelenleg nincs aktív foglalásod.</p>
  <div class="bg-dark-subtle p-4 rounded text-center fs-5  mt-3" th:each="f : ${felhasznalo.foglalasok}">
    <p th:text="'Asztal száma: ' + ${f.asztal.id}"> </p>
    <p th:text="'Asztal férőhelye: ' + ${f.asztal.ferohely}"> </p>
    <p th:text="'Vendégek száma: ' + ${f.vendegek}"> </p>
    <p th:text="'Foglalás kezdete: ' + ${#temporals.format(f.mettol, 'yyyy.MM.dd. HH:mm:ss')}"> </p>
    <p th:text="'Foglalás vége: ' + ${#temporals.format(f.meddig, 'yyyy.MM.dd. HH:mm:ss')}"> </p>
    <div class="d-flex justify-content-center mt-5">
      <button type="button" class="btn btn-danger fs-5" th:data-f-id="${f.id}" data-bs-toggle="modal" data-bs-target="#megerosites"> Foglalás lemondása </button>
    </div>
  </div>
</main>


<div class="modal fade" id="megerosites" tabindex="-1" role="dialog" aria-labelledby="Modal" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalCim">Törlés megerősítése</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
        </button>
      </div>
      <div class="modal-body">
        Biztosan törölni szeretnéd a kiválasztott foglalást?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Mégse</button>
        <form id="torlesForm" method="post">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
          <button type="submit" class="btn btn-danger">Törlés</button>
        </form>
      </div>
    </div>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous">
</script>

<script>
  const modal = document.getElementById('megerosites');
    modal.addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    const foglalasId = button.getAttribute('data-f-id');

    const form = document.getElementById('torlesForm');
    form.action = '/foglalas-lemondas/' + foglalasId;
  });
</script>
</body>
</html>